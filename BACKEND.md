# InsuranceAPI

Lightweight ASP.NET Core Web API for managing insurance policies and claims with Identity-based authentication (JWT) and role-based administration.

---

## Key points
- Target framework: .NET 8
- C# 12
- Authentication: ASP.NET Core Identity + JWT
- Database: Entity Framework Core (configured for Oracle in the project)
- Roles: `Admin`, `Client`
- Swagger UI included for API exploration
- Seeds required roles and an admin user at startup (defaults shown below)

---

## Prerequisites
- .NET 8 SDK installed
- Visual Studio 2022 (or any preferred IDE) /or/ dotnet CLI
- Oracle database accessible (or change EF provider & connection string if you prefer SQL Server)
- (Optional) Postman or curl for testing API requests

---

## Configuration (appsettings.json)
At a minimum set:
- `ConnectionStrings:DefaultConnection` — DB connection string
- `Jwt:Key`, `Jwt:Issuer`, `Jwt:Audience` — JWT settings
- `AdminUser:Email`, `AdminUser:Password` — initial admin credentials (optional — defaults used if missing)

Example:
```
{ "ConnectionStrings":
{ "DefaultConnection": "USER ID=...;PASSWORD=...;DATA SOURCE=..." },
"Jwt": { "Key": "your-very-strong-secret-key", "Issuer": "InsuranceAPI", "Audience": "InsuranceAPIClients" },
"AdminUser": { "Email": "admin@insureone.com", "Password": "Admin@12345" }
}
```


Do NOT commit real secrets to source control. Use user secrets, environment variables, or a secret store for production.

---

## Run locally

Using Visual Studio:
- Open solution, ensure this project is the startup project, then use __Start Debugging__ (F5) or __Start Without Debugging__ (Ctrl+F5).

Using dotnet CLI:
- Restore & build:
  - `dotnet restore`
  - `dotnet build`
- Run:
  - `dotnet run --project InsuranceAPI.csproj`
- The app calls `db.Database.Migrate()` at startup, so migrations will be applied automatically when the configured DB is reachable.

Run database migrations (if you prefer to control them manually):
- `dotnet tool install --global dotnet-ef` (if not installed)
- `dotnet ef database update --project InsuranceAPI.csproj`

---

## Authentication & Roles
- Identity is configured in `Program.cs`. Password and identity options are enforced.
- JWT tokens are generated by the project's authentication service (see `JwtTokenService` and `AuthController`).
- Admin role is seeded at startup. Default credentials (if not overridden) are:
  - Email: `admin@insureone.com`
  - Password: `Admin@12345`
- Admin-protected endpoints require a valid Bearer token and the `Admin` role.

Sample Authorization header:
- `Authorization: Bearer {token}`

---

## Main Admin endpoints (require role: Admin)
Base route: `/api/admin`

- GET `/api/admin/users`  
  List users (Id, UserName, FullName)

- GET `/api/admin/users/{userId}/policies`  
  Get policies for a user

- PUT `/api/admin/policies/{id}`  
  Update a policy (body: `PolicyUpdateDto`)

- DELETE `/api/admin/policies/{id}`  
  Delete a policy

- GET `/api/admin/users/{userId}/claims`  
  Get claims for a user

- PUT `/api/admin/claims/{id}`  
  Update claim status (body: `ClaimStatusUpdateDto`)

- DELETE `/api/admin/claims/{id}`  
  Delete a claim

Use Swagger (when in Development) to explore endpoints: `/swagger`

---

## Running tests
- From CLI: `dotnet test`
- From Visual Studio: use the __Test Explorer__.

---

## Notes & recommendations
- The project currently references Oracle EF Core. If you want to use SQL Server, update `Program.cs` to `UseSqlServer(...)` and replace EF Core provider packages.
- Keep `Jwt:Key` secret and long enough. For production, store secrets in a secure store.
- Review password & identity options in `Program.cs` to match your security policy.
- CORS policy `AllowFrontend` currently allows `http://localhost:5173` — update for your frontend origin(s).

---
